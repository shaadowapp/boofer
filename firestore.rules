rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Privacy-focused rules without Firebase Auth requirement
    // Users are identified by their custom user ID stored locally
    
    // Allow test collection for connection testing
    match /test/{document} {
      allow read, write: if true; // Allow all for testing
    }
    
    // Allow connection test collection for internet connectivity checks
    match /_connection_test/{document} {
      allow read: if true; // Allow reading for connectivity checks
    }
    
    // Users collection - open for privacy-focused anonymous users
    match /users/{userId} {
      // Anyone can read user profiles (for discovery)
      allow read: if true;
      
      // Anyone can create a user profile (anonymous signup)
      allow create: if true;
      
      // Users can update their own profile (validated by client)
      allow update: if true;
      
      // Users can delete their own profile
      allow delete: if true;
    }
    
    // User metadata collection
    match /user_metadata/{userId} {
      allow read, write: if true;
    }
    
    // Messages collection - open for privacy-focused messaging
    match /conversations/{conversationId}/messages/{messageId} {
      allow read, write: if true;
    }
    
    // Conversations collection - open for privacy-focused messaging
    match /conversations/{conversationId} {
      allow read, write: if true;
    }
    
    // Connection requests - open for privacy-focused connections
    match /connection_requests/{requestId} {
      allow read, write: if true;
    }
    
    // Friends collection - open for privacy-focused friendships
    match /friends/{userId}/friends/{friendId} {
      allow read, write: if true;
    }
    
    // Friend requests collection - open for privacy-focused friend requests
    match /friend_requests/{requestId} {
      allow read, write: if true;
    }
  }
}
